"use strict";(()=>{var b=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var r=(n,t,e,s)=>{for(var a=s>1?void 0:s?f(t,e):t,l=n.length-1,u;l>=0;l--)(u=n[l])&&(a=(s?u(t,e,a):u(a))||a);return s&&a&&b(t,e,a),a};var x=class extends Laya.Scene{};var{regClass:g}=Laya,d=class extends x{onAwake(){Laya.loader.load(["resources/UI/progress.png","resources/UI/progress$bar.png"]).then(()=>{let t=[{url:"scenes/MainGame.ls",type:Laya.Loader.HIERARCHY},{url:"prefab/DropItem.lh",type:Laya.Loader.HIERARCHY}];Laya.loader.load(t,null,Laya.Handler.create(this,this.onLoading,null,!1)).then(()=>{this.progress.value=.98,console.log("加载结束",this.progress.value),Laya.timer.once(1e3,this,()=>{Laya.Scene.open("scenes/MainGame.ls")})}),Laya.loader.on(Laya.Event.ERROR,this,this.onError)})}onError(t){console.log("加载失败: "+t)}onLoading(t){t>.92?this.progress.value=.95:this.progress.value=t,console.log("加载进度: "+t,this.progress.value)}};d=r([g("l8rAM2qeT1aKvguRjxTb6w")],d);var{regClass:B,property:A}=Laya,p=class extends Laya.Script{constructor(){super();this._type=0;this._sound="";this._speed=0}onEnable(){this.clickBtn=this.owner.getChildByName("Button"),this.clickBtn.on(Laya.Event.CLICK,this,this.onBtnClick)}onUpdate(){var e=this.owner;e.y+=this._speed,e.y>Laya.stage.height&&e.removeSelf()}onDisable(){Laya.Pool.recover("DropItem",this.owner)}onBtnClick(e){var s=this.owner;s.removeSelf()}createEffect(){let e=new Laya.Animation;e.loadAnimation("resources/ani/TestAni.ani"),e.on(Laya.Event.COMPLETE,null,s);function s(){e.removeSelf(),Laya.Pool.recover("effect",e)}return e}InitItem(e,s,a,l,u){this._type=e,this._sound=s,this._speed=u;let h=this.owner;h.width=a,h.height=l,this.enabled=!0}};p=r([B("StMufJjgSJGwHzLzkWSBJw")],p);var{regClass:w,property:L}=Laya,i=class{constructor(t,e){this.time=t,this.sound=e}},o=class extends Laya.Script{constructor(){super();this.count=4;this.speed=100;this.itemSize=[293,404];this.dropTimes=[];this.ruleIndex=0;this.rules=[new i(0,""),new i(1e3,""),new i(2e3,""),new i(3e3,""),new i(4e3,""),new i(5e3,""),new i(6e3,""),new i(7e3,""),new i(8e3,""),new i(9e3,""),new i(1e4,""),new i(11e3,""),new i(12e3,""),new i(13e3,""),new i(14e3,""),new i(15e3,"")]}onEnable(){for(let e=0;e<this.count;e++)this.dropTimes.push(0)}onStart(){let e=Laya.stage.width/this.count,s=this.itemSize[1]/this.itemSize[0]*e;this.itemSize[0]=e,this.itemSize[1]=s}onUpdate(){}createDropItem(e){let s=0,a="";if(this.ruleIndex<this.rules.length&&e>=this.rules[this.ruleIndex].time){s=1,console.log("xxxxxxxxxxxxxxxx",this.ruleIndex,this.rules[this.ruleIndex]),a=this.rules[this.ruleIndex].sound;let l=Laya.Pool.getItemByCreateFun("DropItem",this.dropItem.create,this.dropItem);l.getComponent(p).InitItem(s,a,this.itemSize[0],this.itemSize[1],this.speed);let h=[];for(let y=0;y<this.dropTimes.length;y++)(e-this.dropTimes[y])*this.speed>this.itemSize[1]&&h.push(y);let v=Math.floor(Math.random()*h.length);return l.pos(h[v]*this.itemSize[0],-this.itemSize[1]),this.dropTimes[h[v]]=e,this.ruleIndex++,l}return null}};r([L({type:Laya.Prefab})],o.prototype,"dropItem",2),r([L({type:"number"})],o.prototype,"count",2),r([L({type:"number"})],o.prototype,"speed",2),o=r([w("6qVnPVJbQae4mF7ZVShfYg")],o);var c=class extends Laya.Scene{};var{regClass:S,property:J}=Laya,m=class extends c{constructor(){super();this._started=!1;this._updateStop=!1}onEnable(){this._model=this.getComponent(o),Laya.stage.on(Laya.Event.BLUR,this,()=>{this._updateStop=!0}),Laya.stage.on(Laya.Event.FOCUS,this,()=>{this._updateStop=!1}),this.startBtn.on(Laya.Event.CLICK,this,this.onstartBtnClick),Laya.timer.frameLoop(1,this,this.onUpdate)}onstartBtnClick(e){this.startGame()}onUpdate(){if(this._updateStop||!this._started)return;let e=Laya.timer.delta;this._time+=e,this.outPut(this._time.toString()),this.updateTime(),this.tryDrop()}updateTime(){this.timeTxt.text=Math.floor(this._time/1e3)+" s"}tryDrop(){let e=this._model.createDropItem(this._time);e!=null&&this.mainBox.addChild(e)}startGame(){this._started||(this._started=!0,this._model.enabled=!0,this._time=0,this.timeTxt.text="",this.mainBox.visible=!0,this.readyBox.visible=!1)}stopGame(){this._started=!1,this._model.enabled=!1,this.mainBox.visible=!1,this.readyBox.visible=!0,this.mainBox.removeChildren()}outPut(e){this.debugTxt.text=e}};m=r([S("GFUpnOxTQNKLJeNeODFsRw")],m);})();
